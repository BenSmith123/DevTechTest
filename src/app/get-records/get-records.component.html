
<button class="button" (click)="getPosts()">View all appointments</button>
<br><br><br>


<form *ngIf="showIdInput">
  <!-- <button (click)="getPostByID()">Get post by ID</button> -->
  <input type="text" class=txt name="item" [(ngModel)]="inputId" placeholder="Enter an ID">
  <br><span>{{ inputId }}</span>
  <input class="button" type="submit" (click)="getPostByID(inputId)" value="List appointments for user">
</form>


<table *ngIf="showAppointmentsForId">
  <div *ngFor="let post of posts | async; first as isFirst;  last as isLast" > <!-- print out each post object of the list called posts -->
    <!-- need to add all details to isFirst table row
    <span *ngIf="isFirst">
      <tr>
        <th>Id</th>
        <th>Description</th>
        <th>Start</th>
      </tr>
    </span> -->
    <span *ngIf=isLast>last as isLast</span>
    <!-- because the array of id's in the Party field are returned as a string, search the string to find the corresponding id -->
    <!--<tr *ngIf="post.Party.indexOf(getInputId()) != -1">-->
    <!-- <tr *ngIf="partyHasId(post.Party)"> -->
    <tr *ngIf="partyHasId(post.Party, post.Id); else elseBlock">
      <!--<span *ngIf="isFirst"><p>ID {{inputId}} has the following appointments:</p></span>-->


        <th>{{post.Description}}</th>
        <th>{{post.Start | date:'dd-MM-yyyy HH:mm z'}}</th>
        <th>{{post.End | date:'dd-MM-yyyy HH:mm z'}}</th>
        <th>{{post.Notes}}</th>
        <th>{{post.Party}}</th>

    </tr>

    <ng-template #elseBlock *ngIf="isLast"> Alternate text while primary text is hidden</ng-template>


  </div>
</table>



<table class="hoverTable" *ngIf="showAllAppointments">
  <div *ngFor="let post of posts | async; first as isFirst" (click)="onClickAppointment(post)" > <!-- print out each post object of the list called posts -->
    <!-- {{ post | json }} this shows the response in JSON format-->
    <span *ngIf="isFirst" style="color: white;">
      <p>Click an appointment to view appointment details or edit/add note.</p>
      <tr>
        <th>ID</th>
        <th>DESCRIPTION</th>
        <th>START</th>
      </tr>
    </span>

    <tr>
      <th>{{post.Id}}</th>
      <th>{{post.Description}}</th>
      <th>Date: {{post.Start | date:'dd-MM-yyyy'}} <br>Time: {{ post.Start | date:'HH:mm z'}}</th>
    </tr>
  </div>
</table><!-- End of ALL appointments table -->


<div *ngIf="showAppointmentDetails">
  <br>
  <table>
    <tr style="color: white;">
      <th>ID</th>
      <th>Description</th>
      <th>Start</th>
      <th>End</th>
      <th>Notes</th>
      <th>Party</th>
    </tr>

    <tr style="vertical-align: text-top;">
      <th>{{appointment.id}}</th>
      <th>{{appointment.description}}</th>
      <th>Date: {{appointment.start | date:'dd-MM-yyyy'}} <br>Time: {{ appointment.start | date:'HH:mm z'}}</th>
      <th>Date: {{appointment.end | date:'dd-MM-yyyy'}} <br>Time: {{ appointment.end | date:'HH:mm z'}}</th>
      <th>
        <div *ngFor="let note of appointment.notes">-  {{note}}<br></div>
        <div>
          <input type="text" class=txt name="item" [(ngModel)]="inputNote" placeholder="Add a note">
          <input type = "submit" (click)="addNote(appointment, inputNote)" value="Add note">
        </div>
        </th>

        <th>
          <div *ngFor="let userId of appointment.party"> {{userId}} <br> </div>
        </th>
      </tr>
    </table>
</div> <!-- End of appointment details table -->
